(function(a){bonMetaboxInterface={toggle_collapsed_fields:function(){a(".meta_box .collapsed").each(function(){a(this).find("input:checked").parent().parent().nextAll().each(function(){if(a(this).hasClass("last")){a(this).removeClass("hidden");return false}a(this).filter(".hidden").removeClass("hidden")});a("input:checkbox",this).click(function(b){bonMetaboxInterface.unhide_hidden(a(this).attr("id"))})})},unhide_hidden:function(b){b=a("#"+b);if(b.attr("checked")){b.parent().parent().nextAll().removeClass("hidden").addClass("visible")}else{b.parent().parent().nextAll().each(function(){if(a(this).filter(".last").length){a(this).addClass("hidden");return false}a(this).addClass("hidden")})}}};a(document).ready(function(){bonMetaboxInterface.toggle_collapsed_fields();if(!!a.prototype.wpColorPicker){a(".bon-color").wpColorPicker()}var d;a(".meta_box_image").on("click","a.meta_box_upload_image_button",function(i){var h,j;$self=a(this);$div=$self.closest("div.meta_box_image");i.preventDefault();if(d){d.open();return}d=wp.media({title:"Choose Image",multiple:false,library:{type:"image"},button:{text:"Use This Image"}});d.on("select",function(){selection=d.state().get("selection");if(!selection){return}selection.each(function(l){var k="";if(l.attributes.sizes.thumbnail!=undefined){k=l.attributes.sizes.thumbnail.url}else{k=l.attributes.sizes.full.url}var m=l.id;$div.find(".meta_box_preview_image").attr("src",k);$div.find(".meta_box_upload_image").val(m)})});d.open()});a(".meta_box_clear_image_button").click(function(){var h=a(this).parent().siblings(".meta_box_default_image").text();a(this).parent().siblings(".meta_box_upload_image").val("");a(this).parent().siblings(".meta_box_preview_image").attr("src",h);return false});var b;a(".meta_box_file_stuff").on("click","a.meta_box_upload_file_button",function(i){i.preventDefault();var h,j;$self=a(i.target);$div=$self.closest("div.meta_box_file_stuff");if(b){b.open();return}b=wp.media({title:"Choose File",multiple:false,library:{type:"file"},button:{text:"Use This File"}});b.on("select",function(){selection=b.state().get("selection");if(!selection){return}selection.each(function(l){var k=l.attributes.url;var m=l.id;$div.find(".meta_box_filename").text(k);$div.find(".meta_box_upload_file").val(k);$div.find(".meta_box_file").addClass("checked")})});b.open()});a(".meta_box_clear_file_button").click(function(){a(this).parent().siblings(".meta_box_upload_file").val("");a(this).parent().siblings(".meta_box_filename").text("");a(this).parent().siblings(".meta_box_file").removeClass("checked");return false});function c(j){var h=[];for(var k=0;k<j.length;k++){h.push(j[k].val)}}a(".meta_box_repeatable").on("click","a.meta_box_repeatable_add",function(i){var j=a(this).closest(".meta_box_repeatable").find("> tbody > tr:last-child");console.log(j);var k=j.clone(false);k.find("select.chosen").removeAttr("style","").removeAttr("id","").removeClass("chzn-done").data("chosen",null).next().remove();k.find("input.slider-input, input.regular-text, textarea, select, input.upload").val("");k.find("input[type=checkbox], input[type=radio]").attr("checked",false);j.after(k);k.find("input, textarea, select").attr("name",function(m,l){return l.replace(/(\d+)/,function(o,p){return Number(p)+1})});k.find("input, textarea, select, .ui-slider").attr("id",function(l,m){return m.replace(/(\d+)/,function(o,p){return Number(p)+1})});k.find(".ui-slider").each(function(){var l=parseInt(a(this).data("max"));var m=parseInt(a(this).data("min"));var n=parseInt(a(this).data("step"));a(this).slider({value:0,min:m,max:l,step:n,slide:function(o,p){a(this).next().val(p.value)}})});k.find(".datepicker").each(function(){a(this).datepicker({dateFormat:"yy-mm-dd"})});var h=[];a("input.repeatable_id:text").each(function(){h.push(a(this).val())});k.find("input.repeatable_id").val(Number(Math.max.apply(Math,h))+1);if(!!a.prototype.chosen){k.find("select.chosen").chosen({allow_single_deselect:true})}i.preventDefault()});a(".meta_box_repeatable").on("click","a.meta_box_repeatable_remove",function(h){a(this).closest("tr").remove();h.preventDefault()});a(".meta_box_repeatable > tbody").sortable({opacity:0.6,revert:true,cursor:"move",handle:".hndle"});a(".sort_list").sortable({connectWith:".sort_list",opacity:0.6,revert:true,cursor:"move",cancel:".post_drop_sort_area_name",items:"li:not(.post_drop_sort_area_name)",update:function(i,j){var h=a(this).sortable("toArray");var k=a(this).attr("id");a(".store-"+k).val(h)}});a(".sort_list").disableSelection();if(!!a.prototype.chosen){a(".chosen").chosen({allow_single_deselect:true})}a(".radio-img-img").click(function(){a(this).parent().parent().find(".radio-img-img").removeClass("radio-img-selected");a(this).addClass("radio-img-selected")});a(".radio-img-label").hide();a(".radio-img-img").show();a(".radio-img-radio").hide();var e;var f=a(".image-gallery-input");var g=a(".gallery-images-container ul.gallery-images");a(".add-gallery-images ").on("click","a",function(i){var h=a(this);if(e){e.open();return}e=wp.media.frames.downloadable_file=wp.media({title:"Add Images to Gallery",button:{text:"Add to gallery",},multiple:true});e.on("select",function(){var j=e.state().get("selection");var k=f.val();j.map(function(m){m=m.toJSON();if(m.id){if(k!=""){at_id=","+m.id}else{at_id=m.id}k+=at_id;var l="";if(typeof m.sizes.thumbnail!="undefined"){l=m.sizes.thumbnail.url}else{l=m.url}g.append('								<li class="image" data-attachment_id="'+m.id+'">									<img src="'+l+'" />									<ul class="actions">										<li><a href="#" class="delete" title="Delete image">Delete</a></li>									</ul>								</li>')}});f.val(k)});e.open();return false});g.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:true,forceHelperSize:false,helper:"clone",opacity:0.65,placeholder:"gallery-image-placeholder",start:function(h,i){i.item.css("background-color","#f6f6f6")},stop:function(h,i){i.item.removeAttr("style")},update:function(h,i){var j="";a(".gallery-images-container ul li.image").css("cursor","default").each(function(){var k=a(this).data("attachment_id");j=j+k+","});f.val(j)}});a(".gallery-images-container").on("click","a.delete",function(){a(this).closest("li.image").remove();var i="";var h=a(".gallery-images-container ul li.image").length;a(".gallery-images-container ul li.image").css("cursor","default").each(function(){var j=a(this).data("attachment_id");i=i+j+","});if(i.substr(i.length-1)==","){i=i.substr(0,i.length-1)}f.val(i);return false})})})(jQuery);